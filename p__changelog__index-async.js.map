{"version":3,"sources":["src/pages/changelog/index.tsx"],"sourcesContent":["import { PageContainer } from '@ant-design/pro-components';\nimport { XMarkdown } from '@ant-design/x-markdown';\nimport { useModel } from '@umijs/max';\nimport { Card, Spin, Typography } from 'antd';\nimport React, { useEffect, useState } from 'react';\nimport '@ant-design/x-markdown/themes/light.css';\nimport '@ant-design/x-markdown/themes/dark.css';\n\n// 构建时注入的CHANGELOG内容（通过构建脚本处理）\ndeclare global {\n  const __CHANGELOG_CONTENT__: string;\n}\n\nconst ChangelogPage: React.FC = () => {\n  const [changelogContent, setChangelogContent] = useState<string>('');\n  const [loading, setLoading] = useState<boolean>(true);\n  // 获取全局初始状态，包含主题设置\n  const { initialState } = useModel('@@initialState');\n  // 根据主题设置确定XMarkdown的主题类\n  const isDarkTheme = initialState?.settings?.navTheme === 'realDark';\n  const markdownThemeClass = isDarkTheme\n    ? 'x-markdown-dark'\n    : 'x-markdown-light';\n\n  useEffect(() => {\n    // 开发环境：使用mock API获取内容\n    // 生产环境：使用构建时注入的内容\n    if (process.env.NODE_ENV === 'production') {\n      // 生产环境：使用构建时注入的内容\n      if (typeof __CHANGELOG_CONTENT__ !== 'undefined') {\n        setChangelogContent(__CHANGELOG_CONTENT__);\n        setLoading(false);\n      } else {\n        // 如果构建时注入失败，尝试从dist目录读取\n        fetch('./changelog.md')\n          .then((response) => response.text())\n          .then((content) => {\n            setChangelogContent(content);\n            setLoading(false);\n          })\n          .catch(() => {\n            setChangelogContent('# 更新记录\\n\\n暂无更新记录，请稍后查看。');\n            setLoading(false);\n          });\n      }\n    } else {\n      // 开发环境：使用mock API\n      const fetchChangelog = async () => {\n        try {\n          const response = await fetch('/api/changelog');\n          if (response.ok) {\n            const content = await response.text();\n            setChangelogContent(content);\n          } else {\n            console.error('Failed to fetch changelog.md');\n            setChangelogContent('# 更新记录\\n\\n暂无更新记录，请稍后查看。');\n          }\n        } catch (error) {\n          console.error('Error fetching changelog.md:', error);\n          setChangelogContent('# 更新记录\\n\\n暂无更新记录，请稍后查看。');\n        } finally {\n          setLoading(false);\n        }\n      };\n\n      fetchChangelog();\n    }\n  }, []);\n\n  return (\n    <PageContainer title=\"更新记录\">\n      <Card>\n        {loading ? (\n          <div style={{ textAlign: 'center', padding: '40px' }}>\n            <Spin size=\"large\" />\n          </div>\n        ) : (\n          <XMarkdown className={markdownThemeClass}>\n            {changelogContent}\n          </XMarkdown>\n        )}\n      </Card>\n    </PageContainer>\n  );\n};\n\nexport default ChangelogPage;\n"],"names":[],"mappings":";;;;;;;4BAsFA;;;eAAA;;;;;;sCAtF8B;kCACJ;4BACD;6BACc;0DACI;;;;;;;;;;;;AAS3C,MAAM,gBAA0B;QAMV;;IALpB,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,eAAQ,EAAS;IACjE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,eAAQ,EAAU;IAEhD,MAAM,EAAE,YAAY,EAAE,GAAG,IAAA,aAAQ,EAAC;IAElC,MAAM,cAAc,CAAA,yBAAA,oCAAA,yBAAA,aAAc,QAAQ,cAAtB,6CAAA,uBAAwB,QAAQ,MAAK;IACzD,MAAM,qBAAqB,cACvB,oBACA;IAEJ,IAAA,gBAAS,EAAC;YAWK,UACA;QASN;YAEL,MAAM,iBAAiB;gBACrB,IAAI;oBACF,MAAM,WAAW,MAAM,MAAM;oBAC7B,IAAI,SAAS,EAAE,EAAE;wBACf,MAAM,UAAU,MAAM,SAAS,IAAI;wBACnC,oBAAoB;oBACtB,OAAO;wBACL,QAAQ,KAAK,CAAC;wBACd,oBAAoB;oBACtB;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,gCAAgC;oBAC9C,oBAAoB;gBACtB,SAAU;oBACR,WAAW;gBACb;YACF;YAEA;QACF;IACF,GAAG,EAAE;IAEL,OACE,2BAAC,4BAAa;QAAC,OAAM;kBACnB,2BAAC,UAAI;sBACF,UACC,2BAAC;gBAAI,OAAO;oBAAE,WAAW;oBAAU,SAAS;gBAAO;0BACjD,2BAAC,UAAI;oBAAC,MAAK;;;;;;;;;;uBAGb,2BAAC,oBAAS;gBAAC,WAAW;0BACnB;;;;;;;;;;;;;;;;AAMb;GAvEM;;QAIqB,aAAQ;;;KAJ7B;IAyEN,WAAe"}