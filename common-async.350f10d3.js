(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_suno-cover-arranger"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_suno-cover-arranger"]||[]).push([["common"],{d5881563:function(e,t,s){"use strict";s.d(t,"__esModule",{value:!0}),s.d(t,"useApiKey",{enumerable:!0,get:function(){return o;}});var r=s("b2254a00"),a=s("e236400f");let o=()=>{let[e,t]=(0,r.useState)(""),[s,o]=(0,r.useState)("deepseek"),[i,n]=(0,r.useState)(!0),l=async e=>{try{console.log("Loading API Key for model:",e);let s=await a.db.getUserApiKeys(1);console.log("All user API Keys:",s);let r=s.find(t=>t.model===e);for(let i of(console.log("Found API Key for model",e,":",r),t((null==r?void 0:r.apiKey)||""),o(e),console.log("Updating current API Key status for model",e),s))await a.db.updateApiKey(i.id,{isCurrent:i.model===e});}catch(s){console.error("Failed to load API Key for model:",e,s),t(""),o(e);}};(0,r.useEffect)(()=>{(async()=>{try{console.log("Loading initial API Key and Model...");let e=await a.db.getCurrentApiKey(1);e?(console.log("Found current API Key:",e),t(e.apiKey),o(e.model)):(console.log("No current API Key found, using default model deepseek"),await l("deepseek"));}catch(e){console.error("Failed to load initial API Key and Model:",e);}finally{n(!1);}})();},[]);let d=async e=>{e!==s&&(n(!0),await l(e),n(!1));},u=async()=>{try{console.log("Deleting API Key for model:",s);let e=(await a.db.getUserApiKeys(1)).find(e=>e.model===s);return e&&(console.log("Deleting API Key with ID:",e.id),await a.db.deleteApiKey(e.id)),t(""),console.log("API Key deleted successfully"),!0;}catch(e){return console.error("Failed to delete API Key:",e),!1;}};return{apiKey:e,model:s,isLoading:i,saveApiKey:async(e,s="deepseek")=>{try{console.log("Saving API Key and Model:",{apiKey:e,model:s});let r=await a.db.createApiKey({userId:1,apiKey:e,model:s,isCurrent:!0});return console.log("Saved API Key and Model to DB:",r),t(e),o(s),!0;}catch(e){return console.error("Failed to save API Key and Model:",e),!1;}},deleteApiKey:u,validateApiKey:e=>{let t=e.trim();return/^sk-/.test(t)||/^AIza/.test(t);},switchModel:d};};},e236400f:function(e,t,s){s.d(t,"__esModule",{value:!0}),s.e(t,{db:function(){return l;}});var r=s("777fffbe"),a=s("fb57420d"),o=r._(a);let i=Symbol.for("Dexie"),n=globalThis[i]||(globalThis[i]=o.default);if(o.default.semVer!==n.semVer)throw Error(`Two different versions of Dexie loaded in the same app: ${o.default.semVer} and ${n.semVer}`);let l=new class extends n{users;projects;styleConfigs;promptRecords;apiKeys;constructor(){super("SunoCoverArrangerDB"),this.version(1).stores({users:"++id, name, email, createdAt",projects:"++id, title, userId, createdAt, updatedAt",styleConfigs:"++id, name, userId, isDefault, createdAt, updatedAt",promptRecords:"++id, userId, createdAt, [aiResult.styles], [aiResult.lyrics], [aiResult.model]",apiKeys:"++id, userId, apiKey, model, isCurrent, createdAt"}),this.users=this.table("users"),this.projects=this.table("projects"),this.styleConfigs=this.table("styleConfigs"),this.promptRecords=this.table("promptRecords"),this.apiKeys=this.table("apiKeys");}async createUser(e){let t={...e,createdAt:new Date},s=await this.users.add(t);return{...t,id:s};}async getUser(e){return this.users.get(e);}async updateUser(e,t){return this.users.update(e,t);}async deleteUser(e){await this.users.delete(e);}async getAllUsers(){return this.users.toArray();}async createProject(e){let t=new Date,s={...e,createdAt:t,updatedAt:t},r=await this.projects.add(s);return{...s,id:r};}async getProject(e){return this.projects.get(e);}async updateProject(e,t){return this.projects.update(e,{...t,updatedAt:new Date});}async deleteProject(e){await this.projects.delete(e);}async getUserProjects(e){return this.projects.where("userId").equals(e).toArray();}async createStyleConfig(e){let t=new Date,s={...e,createdAt:t,updatedAt:t};s.isDefault&&await this.styleConfigs.where({userId:s.userId,isDefault:!0}).modify({isDefault:!1,updatedAt:t});let r=await this.styleConfigs.add(s);return{...s,id:r};}async getStyleConfig(e){return this.styleConfigs.get(e);}async updateStyleConfig(e,t){let s=new Date;if(t.isDefault){let t=await this.styleConfigs.get(e);t&&await this.styleConfigs.where({userId:t.userId,isDefault:!0}).modify({isDefault:!1,updatedAt:s});}return this.styleConfigs.update(e,{...t,updatedAt:s});}async deleteStyleConfig(e){await this.styleConfigs.delete(e);}async getUserStyleConfigs(e){return this.styleConfigs.where("userId").equals(e).toArray();}async getDefaultStyleConfig(e){return this.styleConfigs.where({userId:e,isDefault:!0}).first();}async createPromptRecord(e){let t={...e,createdAt:new Date},s=await this.promptRecords.add(t);return{...t,id:s};}async getPromptRecord(e){return this.promptRecords.get(e);}async updatePromptRecord(e,t){return this.promptRecords.update(e,t);}async deletePromptRecord(e){await this.promptRecords.delete(e);}async getUserPromptRecords(e,t){let s=this.promptRecords.where("userId").equals(e).sortBy("createdAt").then(e=>e.reverse());return t?(await s).slice(0,t):s;}async searchPromptRecords(e,t,s){let r=(await this.getUserPromptRecords(e)).filter(e=>JSON.stringify(e).toLowerCase().includes(t.toLowerCase()));return s?r.slice(0,s):r;}async getRecentPromptRecords(e,t=7){let s=new Date;return s.setDate(s.getDate()-t),this.promptRecords.where("userId").equals(e).and(e=>(e.createdAt||new Date(0))>=s).sortBy("createdAt").then(e=>e.reverse());}async createApiKey(e){console.log("Creating new API Key:",e);let t={...e,createdAt:new Date};t.isCurrent&&(console.log("Setting new API Key as current, updating existing current keys..."),await this.apiKeys.where({userId:t.userId,isCurrent:!0}).modify({isCurrent:!1}));let s=await this.apiKeys.add(t),r={...t,id:s};return console.log("Created API Key:",r),r;}async getApiKey(e){return this.apiKeys.get(e);}async updateApiKey(e,t){if(t.isCurrent){let t=await this.apiKeys.get(e);t&&await this.apiKeys.where({userId:t.userId,isCurrent:!0}).modify({isCurrent:!1});}return this.apiKeys.update(e,t);}async deleteApiKey(e){await this.apiKeys.delete(e);}async getUserApiKeys(e){return this.apiKeys.where("userId").equals(e).toArray();}async getCurrentApiKey(e){console.log("Getting current API Key for user:",e);let t=await this.apiKeys.where("userId").equals(e).toArray();console.log("All user API Keys:",t);let s=t.find(e=>e.isCurrent);return console.log("Found current API Key:",s),s;}};}}]);
//# sourceMappingURL=common-async.350f10d3.js.map