{"version":3,"sources":["src/pages/ai-setting/index.tsx"],"sourcesContent":["import { DeleteOutlined, SaveOutlined } from '@ant-design/icons';\nimport {\n  PageContainer,\n  ProCard,\n  ProForm,\n  ProFormText,\n} from '@ant-design/pro-components';\nimport { Alert, Form, message, Radio, Space, Typography } from 'antd';\nimport { FormInstance } from 'antd/es/form';\nimport React, { useEffect } from 'react';\n\nimport { useApiKey } from '@/hooks/useApiKey';\nimport { db } from '@/services/db';\nimport type { ApiKey } from '@/shared/types';\n\nconst { Text, Paragraph, Title } = Typography;\n\nconst AISettingPage: React.FC = () => {\n  // 使用自定义hook管理API Key，包括新添加的switchModel方法\n  const {\n    apiKey,\n    model,\n    isLoading,\n    saveApiKey,\n    deleteApiKey,\n    validateApiKey,\n    switchModel,\n  } = useApiKey();\n  // 创建 FormInstance 的引用\n  const [form] = Form.useForm();\n\n  // 当API Key加载完成后，设置到表单中\n  useEffect(() => {\n    if (!isLoading) {\n      form.setFieldsValue({\n        model: model || 'deepseek',\n        apiKey: apiKey,\n      });\n    }\n  }, [apiKey, model, isLoading, form]);\n\n  // 处理模型变化，使用新添加的switchModel方法\n  const handleModelChange = async (e: any) => {\n    const newModel = e.target.value;\n    console.log('Changing model to:', newModel);\n    await switchModel(newModel);\n  };\n\n  // 表单提交处理\n  const handleFormSubmit = async (values: {\n    model: string;\n    apiKey: string;\n  }) => {\n    // 验证API Key格式\n    if (!validateApiKey(values.apiKey)) {\n      message.error('API Key格式不正确，请输入有效的API Key');\n      return;\n    }\n\n    const result = await saveApiKey(values.apiKey, values.model);\n    if (result) {\n      message.success('API Key 已成功保存');\n    } else {\n      message.error('保存API Key失败，请稍后重试');\n    }\n  };\n\n  // 表单重置处理\n  const handleFormReset = async () => {\n    const result = await deleteApiKey();\n    if (result) {\n      // 清空表单内容\n      form.setFieldsValue({\n        model: 'deepseek',\n        apiKey: '',\n      });\n      message.success('API Key 已删除');\n    } else {\n      message.error('删除API Key失败，请稍后重试');\n    }\n  };\n\n  return (\n    <PageContainer>\n      <Space direction=\"vertical\" size=\"large\" style={{ display: 'flex' }}>\n        <ProCard>\n          <ProForm\n            layout=\"vertical\"\n            initialValues={{\n              model: model || 'deepseek',\n              apiKey: apiKey,\n            }}\n            form={form}\n            onFinish={handleFormSubmit}\n            onReset={handleFormReset}\n            submitter={{\n              searchConfig: {\n                submitText: '保存 API Key',\n                resetText: '删除 API Key',\n              },\n            }}\n            loading={isLoading}\n          >\n            <ProForm.Item\n              name=\"model\"\n              label=\"首选 AI 模型\"\n              rules={[{ required: true, message: '请选择首选 AI 模型' }]}\n            >\n              <Radio.Group onChange={handleModelChange}>\n                <Radio value=\"deepseek\">DeepSeek</Radio>\n                <Radio value=\"gemini\">Google Gemini</Radio>\n              </Radio.Group>\n            </ProForm.Item>\n\n            <ProFormText.Password\n              name=\"apiKey\"\n              label=\"API Key\"\n              placeholder=\"请输入所选 AI 模型的 API Key\"\n              fieldProps={{\n                size: 'large',\n              }}\n              rules={[\n                {\n                  required: true,\n                  message: '请输入 API Key',\n                },\n                {\n                  validator: (_rule, value) => {\n                    if (!value || validateApiKey(value)) {\n                      return Promise.resolve();\n                    }\n                    return Promise.reject(\n                      new Error('API Key格式不正确，请输入有效的 API Key'),\n                    );\n                  },\n                },\n              ]}\n            />\n\n            <Alert\n              title=\"温馨提示\"\n              description={\n                <Paragraph>\n                  <ul>\n                    <li>您的 API Key 仅保存在本地设备</li>\n                    <li>不会上传至任何第三方服务器</li>\n                    <li>仅通过 HTTPS 直连 DeepSeek 官方 API</li>\n                    <li>您可随时删除保存的 API Key</li>\n                  </ul>\n                </Paragraph>\n              }\n              type=\"success\"\n              style={{ marginBottom: 24 }}\n            />\n          </ProForm>\n        </ProCard>\n\n        <ProCard>\n          <Title level={4}>\n            DeepSeek API Key 一分钟申请 + 充值指南（新手版）\n          </Title>\n          <Paragraph>\n            <ol>\n              <li>\n                打开官网：\n                <a\n                  href=\"https://platform.deepseek.com/\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  https://www.deepseek.cn/register\n                </a>\n              </li>\n              <li>点击右上角 【登录 / 注册】（手机号、邮箱、微信都可以）</li>\n              <li>根据提示完成注册（手机号、邮箱、微信都可以）</li>\n              <li>登录后，在左侧找到 【API 密钥 / API Keys】</li>\n              <li>点击 【创建 API Key】，输入名称并确认</li>\n              <li>复制生成的 API Key（记得先保存好，之后看不到完整内容）</li>\n              <li>\n                在 DeepSeek 平台完成充值：10 元起充，支持微信、支付宝，10\n                元一般能用挺久。\n              </li>\n              <li>回到本应用 → 打开 设置 / AI 设置 → 粘贴 API Key → 保存。</li>\n              <li>完成！现在就可以正常使用各项 AI 生成功能了。</li>\n            </ol>\n          </Paragraph>\n        </ProCard>\n      </Space>\n    </PageContainer>\n  );\n};\n\nexport default AISettingPage;\n"],"names":[],"mappings":"2QAgMA,+CAAA,iPAvLiC,gBAEP,YAI1B,GAAM,CAAE,KAAA,CAAI,CAAE,UAAA,CAAS,CAAE,MAAA,CAAK,CAAE,CAAG,SAAU,KAiL7C,EA/KgC,KAE9B,GAAM,CACJ,OAAA,CAAM,CACN,MAAA,CAAK,CACL,UAAA,CAAS,CACT,WAAA,CAAU,CACV,aAAA,CAAY,CACZ,eAAA,CAAc,CACd,YAAA,CAAW,CACZ,CAAG,GAAA,WAAS,IAEP,CAAC,EAAK,CAAG,SAAI,CAAC,OAAO,GAG3B,GAAA,WAAS,EAAC,KACH,GACH,EAAK,cAAc,CAAC,CAClB,MAAO,GAAS,WAChB,OAAQ,CACV,GAEJ,EAAG,CAAC,EAAQ,EAAO,EAAW,EAAK,EAGnC,IAAM,EAAoB,MAAO,IAC/B,IAAM,EAAW,EAAE,MAAM,CAAC,KAAK,CAC/B,QAAQ,GAAG,CAAC,qBAAsB,GAClC,MAAM,EAAY,GACpB,EAGM,EAAmB,MAAO,IAK9B,GAAI,CAAC,EAAe,EAAO,MAAM,EAAG,CAClC,SAAO,CAAC,KAAK,CAAC,0FACd,OACF,CAEe,MAAM,EAAW,EAAO,MAAM,CAAE,EAAO,KAAK,EAEzD,SAAO,CAAC,OAAO,CAAC,0CAEhB,SAAO,CAAC,KAAK,CAAC,uEAElB,EAGM,EAAkB,UACP,MAAM,KAGnB,EAAK,cAAc,CAAC,CAClB,MAAO,WACP,OAAQ,EACV,GACA,SAAO,CAAC,OAAO,CAAC,+BAEhB,SAAO,CAAC,KAAK,CAAC,uEAElB,EAEA,MACE,UAAC,eAAa,WACZ,WAAC,SAAK,EAAC,UAAU,WAAW,KAAK,QAAQ,MAAO,CAAE,QAAS,MAAO,YAChE,UAAC,SAAO,WACN,WAAC,SAAO,EACN,OAAO,WACP,cAAe,CACb,MAAO,GAAS,WAChB,OAAQ,CACV,EACA,KAAM,EACN,SAAU,EACV,QAAS,EACT,UAAW,CACT,aAAc,CACZ,WAAY,uBACZ,UAAW,sBACb,CACF,EACA,QAAS,YAET,UAAC,SAAO,CAAC,IAAI,EACX,KAAK,QACL,MAAM,+BACN,MAAO,CAAC,CAAE,SAAU,CAAA,EAAM,QAAS,gDAAc,EAAE,UAEnD,WAAC,SAAK,CAAC,KAAK,EAAC,SAAU,YACrB,UAAC,SAAK,EAAC,MAAM,oBAAW,aACxB,UAAC,SAAK,EAAC,MAAM,kBAAS,uBAI1B,UAAC,SAAW,CAAC,QAAQ,EACnB,KAAK,SACL,MAAM,UACN,YAAY,+DACZ,WAAY,CACV,KAAM,OACR,EACA,MAAO,CACL,CACE,SAAU,CAAA,EACV,QAAS,4BACX,EACA,CACE,UAAW,CAAC,EAAO,IACjB,AAAI,CAAC,GAAS,EAAe,GACpB,QAAQ,OAAO,GAEjB,QAAQ,MAAM,CACnB,AAAI,MAAM,2FAGhB,EACD,GAGH,UAAC,SAAK,EACJ,MAAM,2BACN,YACE,UAAC,YACC,WAAC,gBACC,UAAC,eAAG,0EACJ,UAAC,eAAG,mFACJ,UAAC,eAAG,oEACJ,UAAC,eAAG,wEAIV,KAAK,UACL,MAAO,CAAE,aAAc,EAAG,SAKhC,WAAC,SAAO,YACN,UAAC,GAAM,MAAO,WAAG,6GAGjB,UAAC,YACC,WAAC,gBACC,WAAC,gBAAG,iCAEF,UAAC,KACC,KAAK,iCACL,OAAO,SACP,IAAI,+BACL,wCAIH,UAAC,eAAG,+JACJ,UAAC,eAAG,yIACJ,UAAC,eAAG,mGACJ,UAAC,eAAG,kGACJ,UAAC,eAAG,uJACJ,UAAC,eAAG,mMAIJ,UAAC,eAAG,4IACJ,UAAC,eAAG,8IAOlB"}