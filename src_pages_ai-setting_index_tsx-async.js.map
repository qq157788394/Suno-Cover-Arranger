{"version":3,"sources":["src/pages/ai-setting/index.tsx"],"sourcesContent":["import { DeleteOutlined, SaveOutlined } from '@ant-design/icons';\nimport {\n  PageContainer,\n  ProCard,\n  ProForm,\n  ProFormText,\n} from '@ant-design/pro-components';\nimport { Alert, Form, message, Radio, Row, Space, Typography } from 'antd';\nimport { FormInstance } from 'antd/es/form';\nimport React, { useEffect } from 'react';\n\nimport { useApiKey } from '@/hooks/useApiKey';\nimport { db } from '@/services/db';\nimport type { ApiKey } from '@/shared/types/types';\n\nconst { Text, Paragraph, Title, Link } = Typography;\n\nconst AISettingPage: React.FC = () => {\n  // 使用自定义hook管理API Key，包括新添加的switchModel方法\n  const {\n    apiKey,\n    model,\n    isLoading,\n    saveApiKey,\n    deleteApiKey,\n    validateApiKey,\n    switchModel,\n  } = useApiKey();\n  // 创建 FormInstance 的引用\n  const [form] = Form.useForm();\n\n  // 当API Key加载完成后，设置到表单中\n  useEffect(() => {\n    if (!isLoading) {\n      form.setFieldsValue({\n        model: model || 'deepseek',\n        apiKey: apiKey,\n      });\n    }\n  }, [apiKey, model, isLoading, form]);\n\n  // 处理模型变化，使用新添加的switchModel方法\n  const handleModelChange = async (e: any) => {\n    const newModel = e.target.value;\n    console.log('Changing model to:', newModel);\n    await switchModel(newModel);\n  };\n\n  // 表单提交处理\n  const handleFormSubmit = async (values: {\n    model: string;\n    apiKey: string;\n  }) => {\n    // 验证API Key格式\n    if (!validateApiKey(values.apiKey)) {\n      message.error('API Key格式不正确，请输入有效的API Key');\n      return;\n    }\n\n    const result = await saveApiKey(values.apiKey, values.model);\n    if (result) {\n      message.success('API Key 已成功保存');\n    } else {\n      message.error('保存API Key失败，请稍后重试');\n    }\n  };\n\n  // 表单重置处理\n  const handleFormReset = async () => {\n    const result = await deleteApiKey();\n    if (result) {\n      // 清空表单内容\n      form.setFieldsValue({\n        model: 'deepseek',\n        apiKey: '',\n      });\n      message.success('API Key 已删除');\n    } else {\n      message.error('删除API Key失败，请稍后重试');\n    }\n  };\n\n  return (\n    <PageContainer>\n      <Space orientation=\"vertical\" size=\"large\">\n        <ProCard>\n          <ProForm\n            layout=\"vertical\"\n            initialValues={{\n              model: model || 'deepseek',\n              apiKey: apiKey,\n            }}\n            form={form}\n            onFinish={handleFormSubmit}\n            onReset={handleFormReset}\n            submitter={{\n              searchConfig: {\n                submitText: '保存 API Key',\n                resetText: '删除 API Key',\n              },\n            }}\n            loading={isLoading}\n          >\n            <ProForm.Item\n              name=\"model\"\n              label=\"首选 AI 模型\"\n              rules={[{ required: true, message: '请选择首选 AI 模型' }]}\n            >\n              <Radio.Group\n                value={model}\n                options={[\n                  {\n                    value: 'deepseek',\n                    label: 'DeepSeek v3.2（需充值，10元起步，支持国货💪）',\n                  },\n                  {\n                    value: 'gemini',\n                    label: 'Google Gemini 3（推荐，可免费白嫖）',\n                  },\n                  { value: 'mimo', label: '小米MiMo V2 Flash（限时免费白嫖，但需要在本地运行，线上无法使用）' },\n                ]}\n                onChange={handleModelChange}\n              />\n            </ProForm.Item>\n\n            <ProFormText.Password\n              name=\"apiKey\"\n              label=\"API Key\"\n              placeholder=\"请输入所选 AI 模型的 API Key\"\n              fieldProps={{\n                size: 'large',\n              }}\n              rules={[\n                {\n                  required: true,\n                  message: '请输入 API Key',\n                },\n                {\n                  validator: (_rule, value) => {\n                    if (!value || validateApiKey(value)) {\n                      return Promise.resolve();\n                    }\n                    return Promise.reject(\n                      new Error('API Key格式不正确，请输入有效的 API Key'),\n                    );\n                  },\n                },\n              ]}\n            />\n\n            <Alert\n              title=\"温馨提示\"\n              description={\n                <Paragraph>\n                  <ul>\n                    <li>您的 API Key 仅保存在本地设备</li>\n                    <li>不会上传至任何第三方服务器</li>\n                    <li>仅通过 HTTPS 直连 AI 模型官方 API</li>\n                    <li>您可随时删除保存的 API Key</li>\n                  </ul>\n                </Paragraph>\n              }\n              type=\"success\"\n              style={{ marginBottom: 24 }}\n            />\n          </ProForm>\n        </ProCard>\n\n        <ProCard split=\"vertical\">\n          <ProCard colSpan={12}>\n            <Title level={4}>\n              DeepSeek API Key 一分钟申请 + 充值指南（新手版）\n            </Title>\n            <Paragraph>\n              <ol>\n                <li>\n                  打开官网：\n                  <Link href=\"https://platform.deepseek.com/\" target=\"_blank\">\n                    https://platform.deepseek.com/\n                  </Link>\n                </li>\n                <li>\n                  点击右上角 <Text code>登录 / 注册</Text>\n                  （手机号、邮箱、微信都可以）\n                </li>\n                <li>根据提示完成注册（手机号、邮箱、微信都可以）</li>\n                <li>\n                  登录后，在左侧找到 <Text code>API 密钥 / API Keys</Text>\n                </li>\n                <li>\n                  点击 <Text code>创建 API Key</Text>，输入名称并确认\n                </li>\n                <li>复制生成的 API Key（记得先保存好，之后看不到完整内容）</li>\n                <li>在 DeepSeek 平台完成充值：10 元起充，支持微信、支付宝</li>\n                <li>回到本应用 → 打开 设置 / AI 设置 → 粘贴 API Key → 保存</li>\n                <li>完成！现在就可以正常使用各项 AI 生成功能了</li>\n              </ol>\n              <Title level={4}>💡 常见问题</Title>\n              <ul>\n                <li>需要付费吗？ 需要。充值 10 元就能用好久</li>\n              </ul>\n            </Paragraph>\n          </ProCard>\n          <ProCard colSpan={12}>\n            <Title level={4}>Gemini API Key 一分钟申请指南（新手版）</Title>\n            <Paragraph>\n              <ol>\n                <li>\n                  打开官网：\n                  <Link href=\"https://aistudio.google.com/\" target=\"_blank\">\n                    https://aistudio.google.com/\n                  </Link>\n                  （注：需要科学上网环境）\n                </li>\n                <li>\n                  登录账号 点击页面上的 <Text code>Sign in</Text>，使用 Google\n                  账号（Gmail）登录。\n                </li>\n                <li>\n                  获取密钥 登录后，点击左上角的 <Text code>Get API key</Text>{' '}\n                  按钮\n                </li>\n                <li>\n                  创建密钥 点击 <Text code>Create API key</Text>{' '}\n                  按钮，如果弹窗询问，选择{' '}\n                  <Text code>Create API key in new project</Text>\n                  （在新项目中创建）\n                </li>\n                <li>\n                  复制并保存 系统会生成一串 AIza 开头的字符，点击 Copy 复制\n                </li>\n                <li>回到本应用 → 打开 设置 / AI 设置 → 粘贴 API Key → 保存</li>\n                <li>完成！现在就可以正常使用各项 AI 生成功能了</li>\n              </ol>\n              <Title level={4}>💡 常见问题</Title>\n              <ul>\n                <li>\n                  需要付费吗？ 不需要。Gemini API\n                  提供免费额度，对于日常使用完全足够，无需绑定信用卡\n                </li>\n              </ul>\n            </Paragraph>\n          </ProCard>\n        </ProCard>\n\n        <ProCard split=\"vertical\">\n          <ProCard colSpan={12}>\n            <Title level={4}>小米MiMo API Key 申请指南（新手版）</Title>\n            <Paragraph>\n              <ol>\n                <li>\n                  打开官网：\n                  <Link href=\"https://platform.xiaomimimo.com/\" target=\"_blank\">\n                    https://platform.xiaomimimo.com/\n                  </Link>\n                </li>\n                <li>\n                  在页面中找到 <Text code>申请 API Key</Text> 按钮，点击\n                </li>\n                <li>\n                  按页面提示，登录 / 注册小米账号 <Text code>登录 / 注册</Text>\n                </li>\n                <li>\n                  创建密钥 点击 <Text code>新建 API Key</Text>{' '}\n                  按钮，输入名称并确认\n                </li>\n                <li>复制并保存 系统会生成一串 sk-开头的字符，点击复制按钮</li>\n                <li>回到本应用 → 打开 设置 / AI 设置 → 粘贴 API Key → 保存</li>\n                <li>完成！现在就可以正常使用各项 AI 生成功能了</li>\n              </ol>\n              <Title level={4}>💡 常见问题</Title>\n              <ul>\n                <li>无法使用？ 请确保在本地运行项目，线上环境无法使用</li>\n                <li>需要付费吗？ 新模型，面向全球公测，限时免费！</li>\n                <li>访问限制？ 国内可直接访问，无需科学上网</li>\n                <li>\n                  模型水平如何？ 新模型，up主只开发了功能，并没有深入进行测试\n                </li>\n              </ul>\n            </Paragraph>\n          </ProCard>\n        </ProCard>\n      </Space>\n    </PageContainer>\n  );\n};\n\nexport default AISettingPage;\n"],"names":[],"mappings":"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"}