{"version":3,"sources":["src/hooks/usePromptRecords.ts","src/pages/record/index.tsx"],"sourcesContent":["import { useCallback, useMemo, useState } from 'react';\nimport { db } from '@/services/db';\nimport type { PromptRecord } from '@/shared/types/types';\n\nexport interface PromptRecordFilters {\n  keyword?: string;\n  dateRange?: [string, string];\n  songLanguages?: string | string[];\n  targetSinger?: string;\n  styleDescription?: string;\n  songName?: string;\n}\n\nexport const usePromptRecords = (currentUserId: number) => {\n  const [loading, setLoading] = useState<boolean>(false);\n  const [records, setRecords] = useState<PromptRecord[]>([]);\n\n  // 获取所有记录\n  const getAllRecords = useCallback(async () => {\n    return await db.getUserPromptRecords(currentUserId);\n  }, [currentUserId]);\n\n  // 日期范围筛选\n  const filterByDateRange = useCallback(\n    (records: PromptRecord[], dateRange?: [string, string]) => {\n      if (\n        !dateRange ||\n        !Array.isArray(dateRange) ||\n        !dateRange[0] ||\n        !dateRange[1]\n      ) {\n        return records;\n      }\n      const startDate = new Date(dateRange[0]);\n      const endDate = new Date(dateRange[1]);\n      endDate.setHours(23, 59, 59, 999);\n      return records.filter((record) => {\n        const recordDate = new Date(record.created_at || new Date(0));\n        return recordDate >= startDate && recordDate <= endDate;\n      });\n    },\n    [],\n  );\n\n  // 歌曲语言筛选\n  const filterBySongLanguages = useCallback(\n    (records: PromptRecord[], songLanguages?: string | string[]) => {\n      if (!songLanguages) {\n        return records;\n      }\n      const languages = Array.isArray(songLanguages)\n        ? songLanguages\n        : [songLanguages];\n      return records.filter((record) =>\n        languages.includes(record.user_input.song_language),\n      );\n    },\n    [],\n  );\n\n  // 目标歌手筛选\n  const filterByTargetSinger = useCallback(\n    (records: PromptRecord[], targetSinger?: string) => {\n      if (!targetSinger || !targetSinger.trim()) {\n        return records;\n      }\n      const lowerCaseTargetSinger = targetSinger.toLowerCase();\n      return records.filter((record) =>\n        record.user_input?.target_singer\n          ?.toLowerCase()\n          .includes(lowerCaseTargetSinger),\n      );\n    },\n    [],\n  );\n\n  // 风格描述筛选\n  const filterByStyleDescription = useCallback(\n    (records: PromptRecord[], styleDescription?: string) => {\n      if (!styleDescription || !styleDescription.trim()) {\n        return records;\n      }\n      const lowerCaseStyleDescription = styleDescription.toLowerCase();\n      return records.filter((record) =>\n        record.user_input?.style_description\n          ?.toLowerCase()\n          .includes(lowerCaseStyleDescription),\n      );\n    },\n    [],\n  );\n\n  // 歌曲名称筛选\n  const filterBySongName = useCallback(\n    (records: PromptRecord[], songName?: string) => {\n      if (!songName || !songName.trim()) {\n        return records;\n      }\n      const lowerCaseSongName = songName.toLowerCase();\n      return records.filter((record) =>\n        record.user_input?.song_name?.toLowerCase().includes(lowerCaseSongName),\n      );\n    },\n    [],\n  );\n\n  // 关键词筛选\n  const filterByKeyword = useCallback(\n    (records: PromptRecord[], keyword?: string) => {\n      if (!keyword || !keyword.trim()) {\n        return records;\n      }\n      const lowerCaseKeyword = keyword.toLowerCase();\n      return records.filter((record) => {\n        // 在歌曲名称、目标歌手、风格描述中搜索关键词\n        return (\n          record.user_input?.song_name\n            ?.toLowerCase()\n            .includes(lowerCaseKeyword) ||\n          record.user_input?.target_singer\n            ?.toLowerCase()\n            .includes(lowerCaseKeyword) ||\n          record.user_input?.style_description\n            ?.toLowerCase()\n            .includes(lowerCaseKeyword) ||\n          record.ai_result?.styles?.toLowerCase().includes(lowerCaseKeyword) ||\n          record.ai_result?.lyrics?.toLowerCase().includes(lowerCaseKeyword)\n        );\n      });\n    },\n    [],\n  );\n\n  // 获取记录列表（整合筛选逻辑）\n  const fetchRecords = useCallback(\n    async (filters: PromptRecordFilters = {}) => {\n      setLoading(true);\n      try {\n        let fetchedRecords = await getAllRecords();\n\n        // 应用所有筛选条件\n        fetchedRecords = filterByKeyword(fetchedRecords, filters.keyword);\n        fetchedRecords = filterByDateRange(fetchedRecords, filters.dateRange);\n        fetchedRecords = filterBySongLanguages(\n          fetchedRecords,\n          filters.songLanguages,\n        );\n        fetchedRecords = filterByTargetSinger(\n          fetchedRecords,\n          filters.targetSinger,\n        );\n        fetchedRecords = filterByStyleDescription(\n          fetchedRecords,\n          filters.styleDescription,\n        );\n        fetchedRecords = filterBySongName(fetchedRecords, filters.songName);\n\n        setRecords(fetchedRecords);\n        return fetchedRecords;\n      } catch (error) {\n        console.error('获取记录失败：', error);\n        setRecords([]);\n        return [];\n      } finally {\n        setLoading(false);\n      }\n    },\n    [\n      getAllRecords,\n      filterByKeyword,\n      filterByDateRange,\n      filterBySongLanguages,\n      filterByTargetSinger,\n      filterByStyleDescription,\n      filterBySongName,\n    ],\n  );\n\n  // 删除单条记录\n  const deleteRecord = useCallback(\n    async (recordId: number) => {\n      try {\n        await db.deletePromptRecord(recordId);\n        // 刷新数据\n        await fetchRecords();\n        return { success: true };\n      } catch (error) {\n        console.error('删除记录失败：', error);\n        return { success: false, error };\n      }\n    },\n    [fetchRecords],\n  );\n\n  // 清空所有记录\n  const clearAllRecords = useCallback(async () => {\n    try {\n      const userRecords = await db.getUserPromptRecords(currentUserId);\n      await Promise.all(\n        userRecords.map((record) => db.deletePromptRecord(record.id!)),\n      );\n      setRecords([]);\n      return { success: true };\n    } catch (error) {\n      console.error('清空记录失败：', error);\n      return { success: false, error };\n    }\n  }, [currentUserId]);\n\n  return {\n    records,\n    loading,\n    fetchRecords,\n    deleteRecord,\n    clearAllRecords,\n  };\n};\n","import {\n  ClockCircleOutlined,\n  DeleteOutlined,\n  EyeOutlined,\n} from '@ant-design/icons';\nimport {\n  PageContainer,\n  type ProColumns,\n  ProTable,\n} from '@ant-design/pro-components';\nimport { useNavigate } from '@umijs/max';\nimport { Alert, Button, Modal, message, Space, Tooltip } from 'antd';\nimport React, { useCallback, useEffect, useMemo } from 'react';\nimport { usePromptRecords } from '@/hooks/usePromptRecords';\nimport type { PromptRecord } from '@/shared/types/types';\n\n// 结构化日志系统\nconst log = {\n  info: (message: string, data?: any) => {\n    console.log(`[INFO] ${new Date().toISOString()}: ${message}`, data || '');\n  },\n  warn: (message: string, data?: any) => {\n    console.warn(`[WARN] ${new Date().toISOString()}: ${message}`, data || '');\n  },\n  error: (message: string, error?: any) => {\n    console.error(\n      `[ERROR] ${new Date().toISOString()}: ${message}`,\n      error || '',\n    );\n  },\n  debug: (message: string, data?: any) => {\n    console.debug(\n      `[DEBUG] ${new Date().toISOString()}: ${message}`,\n      data || '',\n    );\n  },\n};\n\nconst RecordPage: React.FC = () => {\n  // 模拟当前用户ID，实际应用中应该从登录状态获取\n  const currentUserId = 1;\n  // 使用自定义 hook 管理提示词记录\n  const { records, loading, fetchRecords, deleteRecord } =\n    usePromptRecords(currentUserId);\n  // 使用Umi的useNavigate进行路由跳转\n  const navigate = useNavigate();\n\n  // 组件挂载时获取初始数据\n  useEffect(() => {\n    fetchRecords();\n  }, [fetchRecords]);\n\n  // 查看详情\n  const handleViewDetail = useCallback(\n    (record: PromptRecord) => {\n      try {\n        log.info('点击查看详情，准备传递的记录ID', {\n          recordId: record.id,\n          record,\n        });\n\n        // 确保record对象存在且有ID\n        if (!record || !record.id) {\n          log.error('record或record.id为空', { record });\n          message.error('查看详情失败，记录数据不完整');\n          return;\n        }\n\n        // 使用URL参数传递记录ID\n        log.info('开始跳转到首页，携带记录ID参数', { recordId: record.id });\n        navigate(`/?recordId=${record.id}`);\n      } catch (error) {\n        log.error('导航到详情页失败', error);\n        message.error('查看详情失败，请稍后重试');\n      }\n    },\n    [navigate],\n  );\n\n  // 删除单条记录\n  const handleDelete = useCallback(\n    async (record: PromptRecord) => {\n      Modal.confirm({\n        title: '确认删除',\n        content: '确定要删除这条记录吗？该操作无法恢复。',\n        okText: '删除',\n        okType: 'danger',\n        cancelText: '取消',\n        onOk: async () => {\n          try {\n            await deleteRecord(record.id!);\n            message.success('删除成功');\n          } catch (error) {\n            message.error('删除失败');\n            console.error('删除失败：', error);\n          }\n        },\n      });\n    },\n    [deleteRecord],\n  );\n\n  // 处理搜索表单提交前的参数处理\n  const beforeSearchSubmit = useCallback((params: any) => {\n    // 直接返回处理后的参数，这些参数会传递给request函数\n    return params;\n  }, []);\n\n  // 处理表格参数变化并获取数据\n  const handleTableChange = useCallback(\n    async (pagination: any, filters: any, sorter: any, extra: any) => {\n      // 从extra中获取搜索表单的参数\n      const { action, searchFormValues } = extra;\n\n      // 只有在搜索操作时才执行筛选\n      if (action === 'search') {\n        const keyword = searchFormValues?.keyword || '';\n        const dateRange = searchFormValues?.created_at;\n        const songLanguages = searchFormValues?.song_language;\n        const targetSinger = searchFormValues?.target_singer;\n        const styleDescription = searchFormValues?.style_description;\n        const songName = searchFormValues?.song_name;\n\n        await fetchRecords({\n          keyword,\n          dateRange,\n          songLanguages,\n          targetSinger,\n          styleDescription,\n          songName,\n        });\n      }\n    },\n    [fetchRecords],\n  );\n\n  // 表格列配置\n  const columns = useMemo<ProColumns<PromptRecord>[]>(\n    () => [\n      {\n        title: 'ID',\n        dataIndex: 'id',\n        key: 'id',\n        width: 80,\n        hideInSearch: true,\n      },\n      {\n        title: '时间',\n        dataIndex: 'created_at',\n        key: 'created_at',\n        width: 180,\n        valueType: 'dateRange',\n        render: (_, record) => {\n          const createdAt = record.created_at || new Date(0);\n          return (\n            <Tooltip title={new Date(createdAt).toLocaleString()}>\n              <Space>\n                <ClockCircleOutlined />\n                {new Date(createdAt).toLocaleString()}\n              </Space>\n            </Tooltip>\n          );\n        },\n      },\n      {\n        title: '歌曲名称',\n        dataIndex: ['user_input', 'song_name'],\n        key: 'song_name',\n        width: 150,\n        search: true,\n        ellipsis: {\n          showTitle: false,\n        },\n      },\n      {\n        title: '歌曲语言',\n        dataIndex: ['user_input', 'song_language'],\n        key: 'song_language',\n        width: 120,\n        valueType: 'select',\n        valueEnum: {\n          Mandarin: { text: '华语（普通话）' },\n          Cantonese: { text: '粤语' },\n          Minnan: { text: '闽南语' },\n          English: { text: '英语' },\n          Korean: { text: '韩语' },\n          Japanese: { text: '日语' },\n          Other: { text: '其他' },\n        },\n        search: true,\n        // 使用自定义筛选配置，通过类型断言绕过 TypeScript 检查\n        ...({\n          search: {\n            multiple: true,\n            fieldProps: {\n              mode: 'multiple',\n              options: [\n                { value: 'Mandarin', label: '华语（普通话）' },\n                { value: 'Cantonese', label: '粤语' },\n                { value: 'Minnan', label: '闽南语' },\n                { value: 'English', label: '英语' },\n                { value: 'Korean', label: '韩语' },\n                { value: 'Japanese', label: '日语' },\n                { value: 'Other', label: '其他' },\n              ],\n              maxTagCount: 'responsive',\n            },\n          },\n        } as any),\n      },\n      {\n        title: '模仿歌手',\n        dataIndex: ['user_input', 'target_singer'],\n        key: 'target_singer',\n        width: 150,\n        search: true,\n        ellipsis: {\n          showTitle: false,\n        },\n      },\n      {\n        title: '风格备注',\n        dataIndex: ['user_input', 'style_description'],\n        key: 'style_description',\n        width: 200,\n        search: true,\n        ellipsis: {\n          showTitle: false,\n        },\n      },\n      {\n        title: '操作',\n        key: 'action',\n        width: 120,\n        fixed: 'right',\n        hideInSearch: true,\n        render: (_, record) => (\n          <Space size=\"middle\">\n            <Tooltip title=\"查看提示词\">\n              <Button\n                type=\"primary\"\n                icon={<EyeOutlined />}\n                size=\"small\"\n                onClick={() => handleViewDetail(record)}\n              >\n                详情\n              </Button>\n            </Tooltip>\n            <Tooltip title=\"删除\">\n              <Button\n                danger\n                icon={<DeleteOutlined />}\n                size=\"small\"\n                onClick={() => handleDelete(record)}\n              >\n                删除\n              </Button>\n            </Tooltip>\n          </Space>\n        ),\n      },\n    ],\n    [handleViewDetail, handleDelete],\n  );\n\n  return (\n    <PageContainer>\n      <Alert\n        title=\"生成记录仅保存在本地设备，不会上传至服务器，更换设备或浏览器后记录将无法查看。\"\n        banner\n        style={{ marginBottom: 24 }}\n      />\n      <ProTable\n        rowKey=\"id\"\n        columns={columns}\n        // 直接使用records状态作为数据来源\n        dataSource={records}\n        loading={loading}\n        headerTitle=\"提示词生成记录\"\n        options={{\n          reload: () => fetchRecords(),\n          density: true,\n          fullScreen: true,\n        }}\n        scroll={{ x: 'max-content' }}\n        // 使用onChange处理表格参数变化\n        onChange={handleTableChange}\n        pagination={{\n          pageSize: 10,\n          showSizeChanger: true,\n          showQuickJumper: true,\n          showTotal: (total: number) => `共 ${total} 条记录`,\n        }}\n        search={{\n          labelWidth: 'auto',\n          defaultCollapsed: false,\n          span: 6,\n        }}\n        // 添加request属性以确保表格能正确处理数据\n        request={async (params, sort, filter) => {\n          // 当表格首次加载或分页变化时也会调用此方法\n          // params包含了搜索表单的值\n          const keyword = params?.keyword || '';\n          const dateRange = params?.created_at;\n          const songLanguages = params?.song_language;\n          const targetSinger = params?.target_singer;\n          const styleDescription = params?.style_description;\n          const songName = params?.song_name;\n\n          await fetchRecords({\n            keyword,\n            dateRange,\n            songLanguages,\n            targetSinger,\n            styleDescription,\n            songName,\n          });\n\n          return {\n            data: records,\n            success: true,\n            total: records.length,\n          };\n        }}\n        // 在搜索表单提交前处理参数\n        beforeSearchSubmit={beforeSearchSubmit}\n      />\n    </PageContainer>\n  );\n};\n\nexport default React.memo(RecordPage);\n"],"names":[],"mappings":";;;;;;;4BAaa;;;eAAA;;;;;8BAbkC;2BAC5B;;;;;;;;;;AAYZ,MAAM,mBAAmB,CAAC;;IAC/B,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,eAAQ,EAAU;IAChD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,eAAQ,EAAiB,EAAE;IAGzD,MAAM,gBAAgB,IAAA,kBAAW,EAAC;QAChC,OAAO,MAAM,MAAE,CAAC,oBAAoB,CAAC;IACvC,GAAG;QAAC;KAAc;IAGlB,MAAM,oBAAoB,IAAA,kBAAW,EACnC,CAAC,SAAyB;QACxB,IACE,CAAC,aACD,CAAC,MAAM,OAAO,CAAC,cACf,CAAC,SAAS,CAAC,EAAE,IACb,CAAC,SAAS,CAAC,EAAE,EAEb,OAAO;QAET,MAAM,YAAY,IAAI,KAAK,SAAS,CAAC,EAAE;QACvC,MAAM,UAAU,IAAI,KAAK,SAAS,CAAC,EAAE;QACrC,QAAQ,QAAQ,CAAC,IAAI,IAAI,IAAI;QAC7B,OAAO,QAAQ,MAAM,CAAC,CAAC;YACrB,MAAM,aAAa,IAAI,KAAK,OAAO,UAAU,IAAI,IAAI,KAAK;YAC1D,OAAO,cAAc,aAAa,cAAc;QAClD;IACF,GACA,EAAE;IAIJ,MAAM,wBAAwB,IAAA,kBAAW,EACvC,CAAC,SAAyB;QACxB,IAAI,CAAC,eACH,OAAO;QAET,MAAM,YAAY,MAAM,OAAO,CAAC,iBAC5B,gBACA;YAAC;SAAc;QACnB,OAAO,QAAQ,MAAM,CAAC,CAAC,SACrB,UAAU,QAAQ,CAAC,OAAO,UAAU,CAAC,aAAa;IAEtD,GACA,EAAE;IAIJ,MAAM,uBAAuB,IAAA,kBAAW,EACtC,CAAC,SAAyB;QACxB,IAAI,CAAC,gBAAgB,CAAC,aAAa,IAAI,IACrC,OAAO;QAET,MAAM,wBAAwB,aAAa,WAAW;QACtD,OAAO,QAAQ,MAAM,CAAC,CAAC;gBACrB,kCAAA;oBAAA,qBAAA,OAAO,UAAU,cAAjB,0CAAA,mCAAA,mBAAmB,aAAa,cAAhC,uDAAA,iCACI,WAAW,GACZ,QAAQ,CAAC;;IAEhB,GACA,EAAE;IAIJ,MAAM,2BAA2B,IAAA,kBAAW,EAC1C,CAAC,SAAyB;QACxB,IAAI,CAAC,oBAAoB,CAAC,iBAAiB,IAAI,IAC7C,OAAO;QAET,MAAM,4BAA4B,iBAAiB,WAAW;QAC9D,OAAO,QAAQ,MAAM,CAAC,CAAC;gBACrB,sCAAA;oBAAA,qBAAA,OAAO,UAAU,cAAjB,0CAAA,uCAAA,mBAAmB,iBAAiB,cAApC,2DAAA,qCACI,WAAW,GACZ,QAAQ,CAAC;;IAEhB,GACA,EAAE;IAIJ,MAAM,mBAAmB,IAAA,kBAAW,EAClC,CAAC,SAAyB;QACxB,IAAI,CAAC,YAAY,CAAC,SAAS,IAAI,IAC7B,OAAO;QAET,MAAM,oBAAoB,SAAS,WAAW;QAC9C,OAAO,QAAQ,MAAM,CAAC,CAAC;gBACrB,8BAAA;oBAAA,qBAAA,OAAO,UAAU,cAAjB,0CAAA,+BAAA,mBAAmB,SAAS,cAA5B,mDAAA,6BAA8B,WAAW,GAAG,QAAQ,CAAC;;IAEzD,GACA,EAAE;IAIJ,MAAM,kBAAkB,IAAA,kBAAW,EACjC,CAAC,SAAyB;QACxB,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,IAC3B,OAAO;QAET,MAAM,mBAAmB,QAAQ,WAAW;QAC5C,OAAO,QAAQ,MAAM,CAAC,CAAC;gBAGnB,8BAAA,oBAGA,kCAAA,qBAGA,sCAAA,qBAGA,0BAAA,mBACA,0BAAA;YAXF,OACE,EAAA,qBAAA,OAAO,UAAU,cAAjB,0CAAA,+BAAA,mBAAmB,SAAS,cAA5B,mDAAA,6BACI,WAAW,GACZ,QAAQ,CAAC,wBACZ,sBAAA,OAAO,UAAU,cAAjB,2CAAA,mCAAA,oBAAmB,aAAa,cAAhC,uDAAA,iCACI,WAAW,GACZ,QAAQ,CAAC,wBACZ,sBAAA,OAAO,UAAU,cAAjB,2CAAA,uCAAA,oBAAmB,iBAAiB,cAApC,2DAAA,qCACI,WAAW,GACZ,QAAQ,CAAC,wBACZ,oBAAA,OAAO,SAAS,cAAhB,yCAAA,2BAAA,kBAAkB,MAAM,cAAxB,+CAAA,yBAA0B,WAAW,GAAG,QAAQ,CAAC,wBACjD,qBAAA,OAAO,SAAS,cAAhB,0CAAA,2BAAA,mBAAkB,MAAM,cAAxB,+CAAA,yBAA0B,WAAW,GAAG,QAAQ,CAAC;QAErD;IACF,GACA,EAAE;IAIJ,MAAM,eAAe,IAAA,kBAAW,EAC9B,OAAO,UAA+B,CAAC,CAAC;QACtC,WAAW;QACX,IAAI;YACF,IAAI,iBAAiB,MAAM;YAG3B,iBAAiB,gBAAgB,gBAAgB,QAAQ,OAAO;YAChE,iBAAiB,kBAAkB,gBAAgB,QAAQ,SAAS;YACpE,iBAAiB,sBACf,gBACA,QAAQ,aAAa;YAEvB,iBAAiB,qBACf,gBACA,QAAQ,YAAY;YAEtB,iBAAiB,yBACf,gBACA,QAAQ,gBAAgB;YAE1B,iBAAiB,iBAAiB,gBAAgB,QAAQ,QAAQ;YAElE,WAAW;YACX,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,WAAW;YACzB,WAAW,EAAE;YACb,OAAO,EAAE;QACX,SAAU;YACR,WAAW;QACb;IACF,GACA;QACE;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAIH,MAAM,eAAe,IAAA,kBAAW,EAC9B,OAAO;QACL,IAAI;YACF,MAAM,MAAE,CAAC,kBAAkB,CAAC;YAE5B,MAAM;YACN,OAAO;gBAAE,SAAS;YAAK;QACzB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,WAAW;YACzB,OAAO;gBAAE,SAAS;gBAAO;YAAM;QACjC;IACF,GACA;QAAC;KAAa;IAIhB,MAAM,kBAAkB,IAAA,kBAAW,EAAC;QAClC,IAAI;YACF,MAAM,cAAc,MAAM,MAAE,CAAC,oBAAoB,CAAC;YAClD,MAAM,QAAQ,GAAG,CACf,YAAY,GAAG,CAAC,CAAC,SAAW,MAAE,CAAC,kBAAkB,CAAC,OAAO,EAAE;YAE7D,WAAW,EAAE;YACb,OAAO;gBAAE,SAAS;YAAK;QACzB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,WAAW;YACzB,OAAO;gBAAE,SAAS;gBAAO;YAAM;QACjC;IACF,GAAG;QAAC;KAAc;IAElB,OAAO;QACL;QACA;QACA;QACA;QACA;IACF;AACF;GA3Ma;;;;;;;;;;;;;;;;;;;;;;;;;;;;;4BC8Tb;;;eAAA;;;;;;8BAvUO;sCAKA;4BACqB;6BACkC;0DACP;yCACtB;;;;;;;;;;AAIjC,MAAM,MAAM;IACV,MAAM,CAAC,SAAiB;QACtB,QAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,IAAI,OAAO,WAAW,GAAG,EAAE,EAAE,QAAQ,CAAC,EAAE,QAAQ;IACxE;IACA,MAAM,CAAC,SAAiB;QACtB,QAAQ,IAAI,CAAC,CAAC,OAAO,EAAE,IAAI,OAAO,WAAW,GAAG,EAAE,EAAE,QAAQ,CAAC,EAAE,QAAQ;IACzE;IACA,OAAO,CAAC,SAAiB;QACvB,QAAQ,KAAK,CACX,CAAC,QAAQ,EAAE,IAAI,OAAO,WAAW,GAAG,EAAE,EAAE,QAAQ,CAAC,EACjD,SAAS;IAEb;IACA,OAAO,CAAC,SAAiB;QACvB,QAAQ,KAAK,CACX,CAAC,QAAQ,EAAE,IAAI,OAAO,WAAW,GAAG,EAAE,EAAE,QAAQ,CAAC,EACjD,QAAQ;IAEZ;AACF;AAEA,MAAM,aAAuB;;IAE3B,MAAM,gBAAgB;IAEtB,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,YAAY,EAAE,YAAY,EAAE,GACpD,IAAA,kCAAgB,EAAC;IAEnB,MAAM,WAAW,IAAA,gBAAW;IAG5B,IAAA,gBAAS,EAAC;QACR;IACF,GAAG;QAAC;KAAa;IAGjB,MAAM,mBAAmB,IAAA,kBAAW,EAClC,CAAC;QACC,IAAI;YACF,IAAI,IAAI,CAAC,oBAAoB;gBAC3B,UAAU,OAAO,EAAE;gBACnB;YACF;YAGA,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE;gBACzB,IAAI,KAAK,CAAC,sBAAsB;oBAAE;gBAAO;gBACzC,aAAO,CAAC,KAAK,CAAC;gBACd;YACF;YAGA,IAAI,IAAI,CAAC,oBAAoB;gBAAE,UAAU,OAAO,EAAE;YAAC;YACnD,SAAS,CAAC,WAAW,EAAE,OAAO,EAAE,CAAC,CAAC;QACpC,EAAE,OAAO,OAAO;YACd,IAAI,KAAK,CAAC,YAAY;YACtB,aAAO,CAAC,KAAK,CAAC;QAChB;IACF,GACA;QAAC;KAAS;IAIZ,MAAM,eAAe,IAAA,kBAAW,EAC9B,OAAO;QACL,WAAK,CAAC,OAAO,CAAC;YACZ,OAAO;YACP,SAAS;YACT,QAAQ;YACR,QAAQ;YACR,YAAY;YACZ,MAAM;gBACJ,IAAI;oBACF,MAAM,aAAa,OAAO,EAAE;oBAC5B,aAAO,CAAC,OAAO,CAAC;gBAClB,EAAE,OAAO,OAAO;oBACd,aAAO,CAAC,KAAK,CAAC;oBACd,QAAQ,KAAK,CAAC,SAAS;gBACzB;YACF;QACF;IACF,GACA;QAAC;KAAa;IAIhB,MAAM,qBAAqB,IAAA,kBAAW,EAAC,CAAC;QAEtC,OAAO;IACT,GAAG,EAAE;IAGL,MAAM,oBAAoB,IAAA,kBAAW,EACnC,OAAO,YAAiB,SAAc,QAAa;QAEjD,MAAM,EAAE,MAAM,EAAE,gBAAgB,EAAE,GAAG;QAGrC,IAAI,WAAW,UAAU;YACvB,MAAM,UAAU,CAAA,6BAAA,uCAAA,iBAAkB,OAAO,KAAI;YAC7C,MAAM,YAAY,6BAAA,uCAAA,iBAAkB,UAAU;YAC9C,MAAM,gBAAgB,6BAAA,uCAAA,iBAAkB,aAAa;YACrD,MAAM,eAAe,6BAAA,uCAAA,iBAAkB,aAAa;YACpD,MAAM,mBAAmB,6BAAA,uCAAA,iBAAkB,iBAAiB;YAC5D,MAAM,WAAW,6BAAA,uCAAA,iBAAkB,SAAS;YAE5C,MAAM,aAAa;gBACjB;gBACA;gBACA;gBACA;gBACA;gBACA;YACF;QACF;IACF,GACA;QAAC;KAAa;IAIhB,MAAM,UAAU,IAAA,cAAO,EACrB,IAAM;YACJ;gBACE,OAAO;gBACP,WAAW;gBACX,KAAK;gBACL,OAAO;gBACP,cAAc;YAChB;YACA;gBACE,OAAO;gBACP,WAAW;gBACX,KAAK;gBACL,OAAO;gBACP,WAAW;gBACX,QAAQ,CAAC,GAAG;oBACV,MAAM,YAAY,OAAO,UAAU,IAAI,IAAI,KAAK;oBAChD,OACE,2BAAC,aAAO;wBAAC,OAAO,IAAI,KAAK,WAAW,cAAc;kCAChD,2BAAC,WAAK;;gCACJ,2BAAC,0BAAmB;;;;;gCACnB,IAAI,KAAK,WAAW,cAAc;;;;;;;;;;;;gBAI3C;YACF;YACA;gBACE,OAAO;gBACP,WAAW;oBAAC;oBAAc;iBAAY;gBACtC,KAAK;gBACL,OAAO;gBACP,QAAQ;gBACR,UAAU;oBACR,WAAW;gBACb;YACF;YACA;gBACE,OAAO;gBACP,WAAW;oBAAC;oBAAc;iBAAgB;gBAC1C,KAAK;gBACL,OAAO;gBACP,WAAW;gBACX,WAAW;oBACT,UAAU;wBAAE,MAAM;oBAAU;oBAC5B,WAAW;wBAAE,MAAM;oBAAK;oBACxB,QAAQ;wBAAE,MAAM;oBAAM;oBACtB,SAAS;wBAAE,MAAM;oBAAK;oBACtB,QAAQ;wBAAE,MAAM;oBAAK;oBACrB,UAAU;wBAAE,MAAM;oBAAK;oBACvB,OAAO;wBAAE,MAAM;oBAAK;gBACtB;gBACA,QAAQ;gBAGN,QAAQ;oBACN,UAAU;oBACV,YAAY;wBACV,MAAM;wBACN,SAAS;4BACP;gCAAE,OAAO;gCAAY,OAAO;4BAAU;4BACtC;gCAAE,OAAO;gCAAa,OAAO;4BAAK;4BAClC;gCAAE,OAAO;gCAAU,OAAO;4BAAM;4BAChC;gCAAE,OAAO;gCAAW,OAAO;4BAAK;4BAChC;gCAAE,OAAO;gCAAU,OAAO;4BAAK;4BAC/B;gCAAE,OAAO;gCAAY,OAAO;4BAAK;4BACjC;gCAAE,OAAO;gCAAS,OAAO;4BAAK;yBAC/B;wBACD,aAAa;oBACf;gBACF;YAEJ;YACA;gBACE,OAAO;gBACP,WAAW;oBAAC;oBAAc;iBAAgB;gBAC1C,KAAK;gBACL,OAAO;gBACP,QAAQ;gBACR,UAAU;oBACR,WAAW;gBACb;YACF;YACA;gBACE,OAAO;gBACP,WAAW;oBAAC;oBAAc;iBAAoB;gBAC9C,KAAK;gBACL,OAAO;gBACP,QAAQ;gBACR,UAAU;oBACR,WAAW;gBACb;YACF;YACA;gBACE,OAAO;gBACP,KAAK;gBACL,OAAO;gBACP,OAAO;gBACP,cAAc;gBACd,QAAQ,CAAC,GAAG,SACV,2BAAC,WAAK;wBAAC,MAAK;;4BACV,2BAAC,aAAO;gCAAC,OAAM;0CACb,2BAAC,YAAM;oCACL,MAAK;oCACL,MAAM,2BAAC,kBAAW;;;;;oCAClB,MAAK;oCACL,SAAS,IAAM,iBAAiB;8CACjC;;;;;;;;;;;4BAIH,2BAAC,aAAO;gCAAC,OAAM;0CACb,2BAAC,YAAM;oCACL,MAAM;oCACN,MAAM,2BAAC,qBAAc;;;;;oCACrB,MAAK;oCACL,SAAS,IAAM,aAAa;8CAC7B;;;;;;;;;;;;;;;;;YAMT;SACD,EACD;QAAC;QAAkB;KAAa;IAGlC,OACE,2BAAC,4BAAa;;YACZ,2BAAC,WAAK;gBACJ,OAAM;gBACN,MAAM;gBACN,OAAO;oBAAE,cAAc;gBAAG;;;;;;YAE5B,2BAAC,uBAAQ;gBACP,QAAO;gBACP,SAAS;gBAET,YAAY;gBACZ,SAAS;gBACT,aAAY;gBACZ,SAAS;oBACP,QAAQ,IAAM;oBACd,SAAS;oBACT,YAAY;gBACd;gBACA,QAAQ;oBAAE,GAAG;gBAAc;gBAE3B,UAAU;gBACV,YAAY;oBACV,UAAU;oBACV,iBAAiB;oBACjB,iBAAiB;oBACjB,WAAW,CAAC,QAAkB,CAAC,EAAE,EAAE,MAAM,IAAI,CAAC;gBAChD;gBACA,QAAQ;oBACN,YAAY;oBACZ,kBAAkB;oBAClB,MAAM;gBACR;gBAEA,SAAS,OAAO,QAAQ,MAAM;oBAG5B,MAAM,UAAU,CAAA,mBAAA,6BAAA,OAAQ,OAAO,KAAI;oBACnC,MAAM,YAAY,mBAAA,6BAAA,OAAQ,UAAU;oBACpC,MAAM,gBAAgB,mBAAA,6BAAA,OAAQ,aAAa;oBAC3C,MAAM,eAAe,mBAAA,6BAAA,OAAQ,aAAa;oBAC1C,MAAM,mBAAmB,mBAAA,6BAAA,OAAQ,iBAAiB;oBAClD,MAAM,WAAW,mBAAA,6BAAA,OAAQ,SAAS;oBAElC,MAAM,aAAa;wBACjB;wBACA;wBACA;wBACA;wBACA;wBACA;oBACF;oBAEA,OAAO;wBACL,MAAM;wBACN,SAAS;wBACT,OAAO,QAAQ,MAAM;oBACvB;gBACF;gBAEA,oBAAoB;;;;;;;;;;;;AAI5B;GAnSM;;QAKF,kCAAgB;QAED,gBAAW;;;KAPxB;IAqSN,iBAAe,cAAK,CAAC,IAAI,CAAC"}